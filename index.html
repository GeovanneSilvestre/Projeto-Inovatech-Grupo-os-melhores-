<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Ãudio â†’ Libras (com Hand Talk)</title>
Â  Â  <link rel="stylesheet" href="estilos.css">
Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
Â  <header>
Â  Â  <h1>ğŸ™ â†’ ğŸ¤ŸVoz em Libras</h1>
Â  </header>

Â  <main>
Â  Â  <section class="panel">
Â  Â  Â  <h2>1) GravaÃ§Ã£o de Ãudio</h2>
Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <button id="btnRec" class="btn rec">ğŸ¤ Nova GravaÃ§Ã£o</button>
Â  Â  Â  Â  <div class="status"><span id="recDot" class="dot"></span><span id="recStatus">Aguardandoâ€¦</span></div>
Â  Â  Â  Â  <textarea id="asrOut" placeholder="O texto reconhecido aparecerÃ¡ aquiâ€¦"></textarea>
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <button id="btnSendToLibras" class="btn">ğŸ¤ŸEnviar para o Hand Talk</button>
Â  Â  Â  Â  Â  <button id="btnClear" class="btn" title="Limpar">ğŸ§¹Limpar</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="legend">Dica: fale, edite o texto se precisar e clique em <span class="kbd">Enviar para o Hand Talk</span>. Em seguida, use o botÃ£o flutuante para traduzir a fala.</div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  <section class="panel">
Â  Â  Â  <h2>2) Traduzir Para Libras</h2>
Â  Â  Â  <div id="textoParaLibras" class="out" aria-live="polite">
Â  Â  Â  Â  <h3>Traduzir a Fala</h3>
Â  Â  Â  </div>
Â  Â  Â  <p class="legend" style="margin-top:8px">A Hand Talk traduz o <em>conteÃºdo textual</em> da pÃ¡gina para Libras atravÃ©s do avatar. Clique no Ã­cone flutuante Ã  direita para abrir o tradutor.</p>
Â  Â  </section>
Â  </main>

Â  <footer>
Â  Â  âš  ObservaÃ§Ã£o: a traduÃ§Ã£o para Libras Ã© realizada pela **Hand Talk**. Este app apenas transcreve o Ã¡udio e escreve o texto na pÃ¡gina para o Hand Talk traduzir. Para uso educacional â€” NÃ£o substitui profissional intÃ©rprete de Libras.
Â  </footer>

Â  Â  <script>
    (function () {
        var ht = document.createElement('script');
        ht.type = 'text/javascript';
        ht.async = true;
        ht.src = 'https://plugin.handtalk.me/handtalk-plugin.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ht, s);
    })();
</script>

Â  <script>
Â  /***********************
Â  Â * Reconhecimento de fala (Web Speech API)
Â  Â ***********************/
Â  const $ = sel => document.querySelector(sel);
Â  const btnRec = $('#btnRec');
Â  const btnSend = $('#btnSendToLibras');
Â  const btnClear = $('#btnClear');
Â  const asrOut = $('#asrOut');
Â  const recDot = $('#recDot');
Â  const recStatus = $('#recStatus');
Â  const librasOut = $('#librasOut');

Â  let recognition = null;
Â  let isRecording = false;
Â  let finalTranscript = '';

Â  function setupASR(){
Â  Â  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
Â  Â  if(!SR){
Â  Â  Â  recStatus.textContent = 'Reconhecimento de fala nÃ£o suportado neste navegador.';
Â  Â  Â  recDot.className = 'dot err';
Â  Â  Â  btnRec.disabled = true;
Â  Â  Â  return;
Â  Â  }
Â  Â  recognition = new SR();
Â  Â  recognition.lang = 'pt-BR';
Â  Â  recognition.continuous = true;
Â  Â  recognition.interimResults = true;

Â  Â  recognition.onstart = () => {
Â  Â  Â  isRecording = true;
Â  Â  Â  btnRec.classList.add('active');
Â  Â  Â  btnRec.textContent = 'â¹Parar GravaÃ§Ã£o';
Â  Â  Â  recStatus.textContent = 'Ouvindoâ€¦ fale normalmente.';
Â  Â  Â  recDot.className = 'dot ok';
Â  Â  };
Â  Â  recognition.onresult = (event) => {
Â  Â  Â  let interim = '';
Â  Â  Â  for (let i = event.resultIndex; i < event.results.length; i++) {
Â  Â  Â  Â  const transcript = event.results[i][0].transcript;
Â  Â  Â  Â  if (event.results[i].isFinal) finalTranscript += transcript + ' ';
Â  Â  Â  Â  else interim += transcript;
Â  Â  Â  }
Â  Â  Â  asrOut.value = (finalTranscript + interim).trim();
Â  Â  };
Â  Â  recognition.onerror = (e) => {
Â  Â  Â  recStatus.textContent = 'Erro: ' + e.error;
Â  Â  Â  recDot.className = 'dot err';
Â  Â  };
Â  Â  recognition.onend = () => {
Â  Â  Â  isRecording = false;
Â  Â  Â  btnRec.classList.remove('active');
Â  Â  Â  btnRec.textContent = 'ğŸ¤Iniciar GravaÃ§Ã£o';
Â  Â  Â  if(!asrOut.value) { recStatus.textContent = 'Aguardandoâ€¦'; recDot.className = 'dot'; }
Â  Â  };
Â  }

Â  setupASR();

Â  btnRec.addEventListener('click', () => {
Â  Â  if(!recognition) return;
Â  Â  if(!isRecording) recognition.start(); else recognition.stop();
Â  });
 
  // FunÃ§Ã£o para enviar o texto para a Hand Talk
    function sendTextToHandTalk(text) {
        // Usa um timeout para garantir que o plugin Hand Talk esteja carregado
        setTimeout(() => {
            if (window.HandTalk) {
                window.HandTalk.set({
                    text: text,
                    showWidget: true
                });
            } else {
                console.error("Plugin Hand Talk nÃ£o encontrado.");
            }
        }, 500); // 500ms de espera para garantir que o plugin carregue
    }

    // Envia o texto para a Hand Talk
    btnSend.addEventListener('click', () => {
        const text = (asrOut.value || '').trim();
        if (!text) {
            recStatus.textContent = 'Nenhum texto para traduzir.';
            recDot.className = 'dot warn';
            return;
        }
        
        // Coloca o texto na div que a Hand Talk irÃ¡ ler
        const textToLibrasDiv = document.getElementById('textoParaLibras');
        textToLibrasDiv.innerHTML = `<h3>Traduzir a Fala</h3><p>${text}</p>`;

        sendTextToHandTalk(text);
        recStatus.textContent = 'Texto enviado. O plugin Hand Talk serÃ¡ exibido para traduÃ§Ã£o.';
        recDot.className = 'dot ok';
    });

Â  btnClear.addEventListener('click', () => { 
Â  Â  asrOut.value = ''; 
Â  Â  const textToLibrasDiv = document.getElementById('textoParaLibras');
Â  Â  textToLibrasDiv.innerHTML = '<h3>Traduzir a Fala</h3>'; 
Â  Â  finalTranscript = ''; // <-- Adicione esta linha!
});

Â  // Qualidade de vida
Â  asrOut.addEventListener('keydown', (e)=>{
Â  Â  if(e.key==='Enter' && (e.ctrlKey||e.metaKey)) btnSend.click();
Â  });
Â  asrOut.placeholder = 'Ex.: "OlÃ¡, bom dia! Gostaria de saber o horÃ¡rio de atendimento."';
Â  </script>
</body>
</html>