<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Áudio → Libras (GIFs UFES)</title>
  <link rel="stylesheet" href="estilos.css">
</head>
<body>

<header>
  <h1>🎙 → 🤟 Voz em Libras</h1>
</header>

<main>
  <!-- Seção de Gravação -->
  <section class="panel">
    <h2>1) Gravação de Áudio</h2>
    <div class="controls">
      <button id="btnRec" class="btn rec">🎤 Nova Gravação</button>
      <div class="status">
        <span id="recDot" class="dot"></span>
        <span id="recStatus">Aguardando…</span>
      </div>
      <textarea id="asrOut" placeholder='Ex.: "Eu vou para a casa com o gato."'></textarea>
      <div class="row">
        <button id="btnSendToLibras" class="btn">🤟 Traduzir</button>
        <button id="btnClear" class="btn">🧹 Limpar</button>
      </div>
      <div class="legend">
        Dica: fale, edite o texto se precisar e clique em <strong>Traduzir</strong>. 
      </div>
    </div>
  </section>

  <!-- Seção dos GIFs -->
  <section class="panel">
    <h2>2) Tradução em Libras</h2>
    <div id="iconeLibras" aria-live="polite"></div>
    <p class="legend">As letras são mostradas usando os GIFs oficiais do alfabeto UFES (A-Z). Letras não reconhecidas aparecem em vermelho.</p>
  </section>
</main>

<footer>
⚠ Observação: este site traduz a voz ou escrita do usuário para linguágem de libras para fins educacionais — não substitui intérprete profissional!
</footer>

<script>
/********** RECONHECIMENTO DE VOZ **********/
const btnRec = document.getElementById("btnRec");
const recDot = document.getElementById("recDot");
const recStatus = document.getElementById("recStatus");
const asrOut = document.getElementById("asrOut");
let recognition;
let isRecording = false;
let finalTranscript = '';

function setupASR() {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) {
    recStatus.textContent = "Reconhecimento de fala não suportado neste navegador.";
    recDot.className = "dot err";
    btnRec.disabled = true;
    return;
  }
  recognition = new SR();
  recognition.lang = "pt-BR";
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onstart = () => {
    isRecording = true;
    btnRec.textContent = "⏹ Parar Gravação";
    recStatus.textContent = "Ouvindo… fale normalmente.";
    recDot.className = "dot ok";
  };

  recognition.onresult = (event) => {
    let interim = '';
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const transcript = event.results[i][0].transcript;
      if (event.results[i].isFinal) finalTranscript += transcript + ' ';
      else interim += transcript;
    }
    asrOut.value = (finalTranscript + interim).trim();
  };

  recognition.onerror = (e) => {
    recStatus.textContent = "Erro: " + e.error;
    recDot.className = "dot err";
  };

  recognition.onend = () => {
    isRecording = false;
    btnRec.textContent = "🎤 Nova Gravação";
    if(!asrOut.value){ recStatus.textContent = "Aguardando…"; recDot.className="dot"; }
  };
}

setupASR();

btnRec.addEventListener("click", () => {
  if (!recognition) return;
  if (!isRecording) recognition.start(); else recognition.stop();
});

/********** DICIONÁRIO DE GIFS (A-Z) **********/
const dicionario = {
  "a": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/a.gif",
  "b": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/b.gif",
  "c": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/c.gif",
  "d": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/d.gif",
  "e": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/e.gif",
  "f": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/f.gif",
  "g": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/g.gif",
  "h": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/h.gif",
  "i": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/i.gif",
  "j": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/j.gif",
  "k": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/k.gif",
  "l": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/l.gif",
  "m": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/m.gif",
  "n": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/n.gif",
  "o": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/o.gif",
  "p": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/p.gif",
  "q": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/q.gif",
  "r": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/r.gif",
  "s": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/s.gif",
  "t": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/t.gif",
  "u": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/u.gif",
  "ú": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/u.gif",
  "v": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/v.gif",
  "w": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/w.gif",
  "x": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/x.gif",
  "y": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/y.gif",
  "z": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/z.gif",
  "é": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/e.gif",
  "à": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/a.gif",
  "á": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/a.gif",
  "ç": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/letras/cedilha.gif",
  "0": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/0.gif",
  "1": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/1.gif",
  "2": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/2.gif",
  "3": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/3.gif",
  "4": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/4.gif",
  "5": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/5.gif",
  "6": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/6.gif",
  "7": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/7.gif",
  "8": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/8.gif",
  "9": "https://acervo.sead.ufes.br/materiais/artes/libras/assets/img/numeros/9.gif"
};

const iconeLibras = document.getElementById("iconeLibras");
const btnSend = document.getElementById("btnSendToLibras");
const btnClear = document.getElementById("btnClear");

/********** FUNÇÃO DE RENDERIZAÇÃO DOS GIFS **********/
function renderizarIcones(texto) {
  iconeLibras.innerHTML = "";
  const textoLower = texto.toLowerCase();
  for (let char of textoLower) {
    if (dicionario[char]) {
      const img = document.createElement("img");
      img.src = dicionario[char];
      img.alt = char;
      iconeLibras.appendChild(img);
    } else if (char === " ") {
      iconeLibras.appendChild(document.createTextNode("   "));
    } else {
      const span = document.createElement("span");
      span.textContent = char;
      iconeLibras.appendChild(span);
    }
  }
}

/********** BOTÕES **********/
btnSend.addEventListener("click", () => {
  const texto = asrOut.value.trim();
  if (!texto) {
    recStatus.textContent = "Nenhum texto para traduzir.";
    recDot.className = "dot warn";
    return;
  }
  renderizarIcones(texto);
  recStatus.textContent = "Texto traduzido em GIFs!";
  recDot.className = "dot ok";
});

btnClear.addEventListener("click", () => {
  asrOut.value = "";
  iconeLibras.innerHTML = "";
  finalTranscript = "";
  recStatus.textContent = "Aguardando…";
  recDot.className = "dot";
});

/********** ATALHO CTRL+ENTER **********/
asrOut.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) btnSend.click();
});
</script>

</body>
</html>
